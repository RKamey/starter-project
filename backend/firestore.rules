rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    match /articles/{articleId} {
      allow read: if true;

      allow create: if request.resource.data.keys().hasAll(['id', 'title', 'author', 'content', 'thumbnailURL', 'createdAt']) &&
                       request.resource.data.size() == 6 &&
                       request.resource.data.id is string &&
                       request.resource.data.title is string &&
                       request.resource.data.author is string &&
                       request.resource.data.content is string &&
                       request.resource.data.thumbnailURL is string &&
                       request.resource.data.thumbnailURL.matches('media/articles/.*') &&
                       request.resource.data.createdAt is timestamp;
      
      allow update: if request.resource.data.keys().hasAll(['id', 'title', 'author', 'content', 'thumbnailURL', 'createdAt']) &&
                       request.resource.data.size() == 6 &&
                       request.resource.data.id is string &&
                       request.resource.data.title is string &&
                       request.resource.data.author is string &&
                       request.resource.data.content is string &&
                       request.resource.data.thumbnailURL is string &&
                       request.resource.data.thumbnailURL.matches('media/articles/.*') &&
                       request.resource.data.createdAt is timestamp;
                              
      allow delete: if true;
    }
    allow read, write: if request.time < timestamp.date(2026, 3, 3);
  }
}